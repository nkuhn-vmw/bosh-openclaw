---
name: openclaw-broker

templates:
  bin/ctl.erb: bin/ctl
  bin/pre-start.erb: bin/pre-start
  config/config.json.erb: config/config.json
  config/bpm.yml.erb: config/bpm.yml
  config/catalog.json.erb: config/catalog.json

packages:
  - openclaw-broker
  - golang-1.22
  - cf-cli

properties:
  openclaw.broker.port:
    description: "Broker API port"
    default: 8080
  openclaw.broker.auth.username:
    description: "Basic auth username"
    default: "openclaw-broker"
  openclaw.broker.auth.password:
    description: "Basic auth password"
  openclaw.broker.tls.enabled:
    description: "Enable TLS"
    default: false
  openclaw.broker.tls.certificate:
    description: "TLS certificate PEM"
  openclaw.broker.tls.private_key:
    description: "TLS private key PEM"
  openclaw.broker.bosh.director_url:
    description: "BOSH Director API URL"
  openclaw.broker.bosh.uaa_url:
    description: "BOSH UAA endpoint URL"
  openclaw.broker.bosh.client_id:
    description: "BOSH UAA client ID"
  openclaw.broker.bosh.client_secret:
    description: "BOSH UAA client secret"
  openclaw.broker.bosh.ca_cert:
    description: "BOSH Director CA certificate"
  openclaw.broker.agent_defaults.openclaw_version:
    description: "Default OpenClaw version for new instances"
    default: "2026.2.10"
  openclaw.broker.agent_defaults.stemcell:
    description: "Stemcell for agent VMs"
    default: "ubuntu-jammy"
  openclaw.broker.agent_defaults.network:
    description: "BOSH network for agent VMs"
    default: "openclaw-agents"
  openclaw.broker.agent_defaults.az:
    description: "Availability zone for agent VMs"
  openclaw.broker.genai.provider:
    description: "GenAI provider type (anthropic, openai, tanzu_genai, external_openai)"
    default: ""
  openclaw.broker.genai.endpoint:
    description: "Default GenAI proxy endpoint"
  openclaw.broker.genai.api_key:
    description: "Default GenAI API key"
  openclaw.broker.genai.model:
    description: "Default model"
  openclaw.broker.genai.api_endpoint:
    description: "External OpenAI-compatible API endpoint"
    default: ""
  openclaw.broker.genai.offering_name:
    description: "Tanzu GenAI service offering name"
    default: ""
  openclaw.broker.genai.plan_name:
    description: "Tanzu GenAI service plan name"
    default: ""
  openclaw.broker.catalog.plans:
    description: "Service plan configurations"
    default:
      - name: developer
        id: "openclaw-developer-plan"
        description: "Dedicated OpenClaw agent for individual developers"
        vm_type: small
        disk_type: "10GB"
        memory: 2048
        metadata:
          displayName: "Developer"
          bullets:
            - "Dedicated VM with isolated WebChat UI"
            - "2GB RAM, 10GB persistent disk"
            - "Cloud LLM integration"
            - "Per-instance SSO"
      - name: developer-plus
        id: "openclaw-developer-plus-plan"
        description: "Enhanced agent with browser automation"
        vm_type: medium
        disk_type: "20GB"
        memory: 4096
        features:
          browser: true
        metadata:
          displayName: "Developer Plus"
          bullets:
            - "Dedicated VM with isolated WebChat UI"
            - "4GB RAM, 20GB persistent disk"
            - "Browser automation enabled"
            - "All messaging channels"
      - name: team
        id: "openclaw-team-plan"
        description: "Shared agent for teams"
        vm_type: large
        disk_type: "50GB"
        memory: 8192
        features:
          browser: true
          multi_user: true
        metadata:
          displayName: "Team"
          bullets:
            - "Dedicated VM with isolated WebChat UI"
            - "8GB RAM, 50GB persistent disk"
            - "Multi-user with Slack/Teams"
            - "Full browser automation"
  openclaw.broker.metering.enabled:
    description: "Enable token usage metering per instance"
    default: true
  openclaw.broker.metering.export_interval_minutes:
    description: "Usage metrics export interval"
    default: 60
  openclaw.broker.limits.max_instances:
    description: "Maximum total agent instances"
    default: 50
  openclaw.broker.limits.max_instances_per_org:
    description: "Maximum instances per CF org"
    default: 10

  # On-demand service instance configuration
  openclaw.broker.on_demand.service_name:
    description: "Service name in the CF marketplace"
    default: "openclaw"
  openclaw.broker.on_demand.plans:
    description: "On-demand service plans (from OpsMan service_plan_forms)"
    default: []
  openclaw.broker.on_demand.stemcell_os:
    description: "Stemcell OS for agent VMs"
    default: "ubuntu-jammy"
  openclaw.broker.on_demand.stemcell_version:
    description: "Stemcell version for agent VMs"
    default: "latest"
  openclaw.broker.on_demand.network:
    description: "BOSH network for on-demand agent VMs"
    default: ""
  openclaw.broker.on_demand.az:
    description: "BOSH availability zones for on-demand agent VMs (array from service_network_az_multi_select)"
    default: []
  openclaw.broker.on_demand.openclaw_release_version:
    description: "OpenClaw BOSH release version for on-demand agent deployments"
    default: "latest"
  openclaw.broker.on_demand.bpm_release_version:
    description: "BPM BOSH release version for on-demand agent deployments"
    default: "1.1.21"
  openclaw.broker.on_demand.routing_release_version:
    description: "Routing BOSH release version for on-demand agent deployments"
    default: "0.283.0"

  # Cloud Foundry platform configuration
  openclaw.broker.cf.system_domain:
    description: "CF system domain"
    default: ""
  openclaw.broker.cf.apps_domain:
    description: "CF apps domain"
    default: ""
  openclaw.broker.cf.deployment_name:
    description: "CF BOSH deployment name"
    default: ""
  openclaw.broker.cf.api_url:
    description: "CF API URL for marketplace provisioning"
    default: ""
  openclaw.broker.cf.admin_username:
    description: "CF admin username for marketplace provisioning"
    default: ""
  openclaw.broker.cf.admin_password:
    description: "CF admin password for marketplace provisioning"
    default: ""
  openclaw.broker.cf.skip_ssl_validation:
    description: "Skip SSL validation when connecting to CF API"
    default: true

  # Security policy
  openclaw.broker.security.sso_enabled:
    description: "Enable SSO for agent WebChat instances"
    default: false
  openclaw.broker.security.sandbox_mode:
    description: "Agent sandbox mode (strict, moderate, loose)"
    default: "strict"
  openclaw.broker.security.control_ui_enabled:
    description: "Enable control UI for agent instances"
    default: false
  openclaw.broker.security.blocked_commands:
    description: "Newline-separated list of blocked shell commands"
    default: ""
  openclaw.broker.security.min_openclaw_version:
    description: "Minimum OpenClaw version to deploy"
    default: ""
  openclaw.broker.security.sso_client_id:
    description: "OAuth2 client ID for SSO proxy on agent instances"
    default: ""
  openclaw.broker.security.sso_client_secret:
    description: "OAuth2 client secret for SSO proxy on agent instances"
    default: ""
  openclaw.broker.security.sso_cookie_secret:
    description: "Cookie encryption secret for SSO proxy sessions"
    default: ""
  openclaw.broker.security.sso_oidc_issuer_url:
    description: "OIDC issuer URL for SSO proxy (e.g., https://uaa.sys.example.com)"
    default: ""

  # NATS TLS configuration (for route registration)
  openclaw.broker.nats.tls.enabled:
    description: "Enable NATS TLS"
    default: false
  openclaw.broker.nats.tls.client_cert:
    description: "NATS TLS client certificate"
    default: ""
  openclaw.broker.nats.tls.client_key:
    description: "NATS TLS client private key"
    default: ""
  openclaw.broker.nats.tls.ca_cert:
    description: "NATS TLS CA certificate"
    default: ""
